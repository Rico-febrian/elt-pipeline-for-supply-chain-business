version: 2

models:
  - name: dim_customer
    description: "Dimension table generated from customer, nation and region tables in staging schema"
    columns:
      - name: sk_customer_key
        description: "dim_customer surrogate key generated from customer table (c_custkey) in the staging schema"
        tests:
          - not_null
          - unique
          - dbt_constraints.primary_key

      - name: nk_customer_key
        description: "Natural key from customer table (c_custkey) in the staging schema" 
        tests:
          - not_null

  - name: dim_supplier
    description: "Dimension table generated from supplier, nation and region tables in staging schema"
    columns:
      - name: sk_supplier_key
        description: "dim_supplier surrogate key generated from supplier table (s_suppkey) in the staging schema"
        tests:
          - not_null
          - unique
          - dbt_constraints.primary_key

      - name: nk_supplier_key
        description: "Natural key from supplier table (s_suppkey) in the staging schema" 
        tests:
          - not_null

  - name: dim_product
    description: "Dimension table generated from part and partsupp tables in staging schema and dim_supplier in the final schema"
    columns:
      - name: sk_part_key
        description: "dim_product surrogate key generated from part (p_partkey) and partsupp (ps_suppkey) tables in the staging schema"
        tests:
          - not_null
          - unique
          - dbt_constraints.primary_key

      - name: sk_supplier_key
        description: "Foreign key from dim_supplier table in the final schema" 
        tests:
          - not_null
          - dbt_constraints.foreign_key:
              pk_table_name: ref('dim_supplier')
              pk_column_name: sk_supplier_key

      - name: nk_part_key
        description: "Natural key from part table (p_partkey) in the staging schema" 
        tests:
          - not_null
    
  - name: dim_date
    description: "Dimension table generated by dbt packages"
    columns:
      - name: date_day
        description: "Primary key for dim_date table"
        tests:
          - not_null
          - dbt_constraints.primary_key

# ------------------------------------------------------------------------------------------------------------------------------------- #

  - name: fct_sales_summary
    description: "Fact table designed to capture information about sales per order/customer, including revenue, COGS, and other metrics"
    columns:
      - name: sk_sales_summary
        description: "Surrogate key for fct_sales_summary table generated from the orders table (o_orderkey, o_custkey) in the staging schema"
        tests:
          - not_null
          - unique
          - dbt_constraints.primary_key

      - name: dd_order_key
        description: "Degenerate dimension key from orders table (o_orderkey) in the staging schema" 
        tests:
          - not_null

      - name: sk_customer_key
        description: "Foreign key from dim_customer table in the final schema"
        tests:
          - not_null
          - dbt_constraints.foreign_key:
              pk_table_name: ref('dim_customer')
              pk_column_name: sk_customer_key

  - name: fct_order_lineitem
    description: "Fact table designed to capture information about order details per line item, including pricing, delivery, and other metrics"
    columns:
      - name: sk_order_lineitem
        description: "Surrogate key for fct_order_lineitem table generated from the lineitem (l_orderkey, l_linenumber) tables in the staging schema and dim_product (sk_part_key) table in the final schema"
        tests:
          - not_null
          - unique
          - dbt_constraints.primary_key

      - name: dd_order_key
        description: "Degenerate dimension key from lineitem table (l_orderkey) in the staging schema" 
        tests:
          - not_null

      - name: sk_part_key
        description: "Foreign key from dim_product table in the final schema"
        tests:
          - not_null
          - dbt_constraints.foreign_key:
              pk_table_name: ref('dim_product')
              pk_column_name: sk_part_key

      - name: sk_supplier_key
        description: "Foreign key from dim_product table in the final schema"
        tests:
          - not_null
          - dbt_constraints.foreign_key:
              pk_table_name: ref('dim_product')
              pk_column_name: sk_supplier_key
      
      - name: order_status
        description: "Indicates the current status of the order: Pending (P), Filled (F), or On Hold (O)"
        tests:
          - accepted_values:
              values: ['P', 'F', 'O']
      
      - name: return_flag
        description: "Indicates the return status of an item: Returned (R), Not Returned (N), or Accepted (A)"
        tests:
          - accepted_values:
              values: ['R', 'N', 'A']

      - name: ship_mode
        description: "indicates the shipping mode selected by the customer"
        tests:
          - accepted_values:
              values: ['REG AIR', 'MAIL', 'RAIL', 'SHIP', 'TRUCK', 'AIR', 'FOB']